<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2D Platformer with Jumping and Gravity</title>
    <style>
        body { 
            margin: 0; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            height: 100vh; 
            background-color: #333; /* Dark background */
        }
        canvas {
            /* We remove the border here, as the drawing is now cleaner */
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5); 
            background-color: #87ceeb; /* Sky blue background for the level */
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas" width="800" height="400"></canvas>

    <script>
        // --- CANVAS SETUP ---
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // --- GAME CONSTANTS ---
        const platformHeight = 20;
        const groundY = canvas.height - platformHeight; // The Y-coordinate of the ground surface

        // --- GAME OBJECTS & STATE ---
        const player = {
            x: 50,
            y: groundY - 30, // Start just above the ground
            width: 30,
            height: 30,
            color: '#ff4500', // Orange
            // Movement/Physics variables
            vy: 0,          // Vertical velocity (for jumping/gravity)
            isJumping: false,
            canJump: true   // Prevents mid-air jumps
        };
        
        // Physics values
        const horizontalSpeed = 2.5; // Constant side-to-side movement speed
        const jumpPower = -15;       // Initial upward velocity for a jump (negative is up in canvas)
        const gravity = 0.9;         // Downward acceleration
        
        let horizontalDirection = 1; // 1 for moving right, -1 for moving left

        // Platform Boundaries (The "Walls")
        const minBound = 0; 
        const maxBound = canvas.width - player.width; 

        // --- INPUT HANDLING ---
        document.addEventListener('keydown', (e) => {
            // Check for SPACEBAR or UP ARROW
            if ((e.code === 'Space' || e.code === 'ArrowUp') && player.canJump) {
                // Initiate jump
                player.vy = jumpPower;
                player.isJumping = true;
                player.canJump = false;
            }
        });

        // --- GAME LOGIC FUNCTIONS ---

        function applyGravity() {
            // Apply gravity to vertical velocity
            player.vy += gravity;

            // Apply vertical velocity to position
            player.y += player.vy;

            // Check for collision with the ground
            if (player.y >= groundY - player.height) {
                player.y = groundY - player.height; // Snap player to the ground
                player.vy = 0;                      // Stop vertical movement
                player.isJumping = false;           // Reset jumping flags
                player.canJump = true;
            }
        }

        function handleHorizontalMovement() {
            // Apply constant horizontal movement
            player.x += horizontalSpeed * horizontalDirection;

            // Collision Detection (Boundary Check)
            if (player.x > maxBound) {
                // Hit the right wall
                horizontalDirection = -1; // Switch to moving left
                player.x = maxBound;      // Snap to the boundary
            } else if (player.x < minBound) {
                // Hit the left wall
                horizontalDirection = 1;  // Switch to moving right
                player.x = minBound;      // Snap to the boundary
            }
        }

        // --- DRAWING FUNCTIONS ---

        function clearCanvas() {
            // **FIX for the "permanent red line"**: 
            // This function clears the entire canvas (and its contents) every frame.
            ctx.clearRect(0, 0, canvas.width, canvas.height); 
        }

        function drawPlatform() {
            ctx.fillStyle = '#228b22'; // Forest Green
            ctx.fillRect(0, groundY, canvas.width, platformHeight);
        }

        function drawPlayer() {
            ctx.fillStyle = player.color;
            ctx.fillRect(player.x, player.y, player.width, player.height);
        }

        // --- GAME LOOP / ANIMATION ---
        function update() {
            // 1. Clear the canvas (Must be the first step to prevent trails)
            clearCanvas();
            
            // 2. Apply Physics and Movement
            applyGravity();
            handleHorizontalMovement();

            // 3. Drawing
            drawPlatform();
            drawPlayer();

            // Request the next frame (Smooth animation)
            requestAnimationFrame(update);
        }

        // --- START GAME ---
        update();

    </script>
</body>
</html>
